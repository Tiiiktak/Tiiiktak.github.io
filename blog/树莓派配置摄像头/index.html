<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>树莓派配置摄像头 - Tiiktak&#39;s</title>
    
    <meta name="description" content="注意：树莓派插电时千万不要插拔摄像头！据说十有八九摄像头会GG，我差点就中招了
安装驱动 首先使用ls指令查看是否加载到了对应的video device设备：
ls -al /etc  没有看到设备开始安装驱动
添加驱动设备到文件夹 sudo vim /etc/modules  在文件末尾添加
bcm2835-v412  修改raspberry的启动配置 进入管理中心开启pi camera
sudo raspi-config  选择interfacing option
开启Camera后重启
检查/dev ls -al /dev/ | grep video  有video设备则成功
使用树莓派摄像头 使用raspistill指令
测试 raspistill -o image.jpg   在使用hdml线连接lcd屏和树莓派时运行，显示屏会显示几秒钟摄像头的实时画面，但使用VNC连接时并不会有实时画面
 raspistill相关  -v：查看调试信息 -w：图像宽度 -h：图像高度 -rot：图像旋转角度，仅支持0，90，180，270度 -o：图像输出地址，若文件名为&rsquo;-&lsquo;，将输出发送至标准输出设备 -t：获取图像前等待时间，默认为5000，即5秒 -tl：多久执行一次图像抓取  生成.h246文件 raspistill -o mykeychain.h264 -t 10000 -w 1280 -h 720  错误 在第一次成功调用后，之后再次调用时多次报错：
mmal: No data received from sensor.">
    <meta name="author" content="">
    
    <link href="https://konosuba.xyz/css/github-gist.min.css" rel="stylesheet">
    <link href="https://konosuba.xyz/css/style.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://konosuba.xyz/img/apple-touch-icon.png">
    <link rel="icon" href="https://konosuba.xyz/img/favicon.ico">
    
    <meta name="generator" content="Hugo 0.55.6" />
    
    <link rel="alternate" type="application/atom+xml" href="https://konosuba.xyz/index.xml" title="Tiiktak&#39;s">
    
    
    
  </head>
  <body class="single">
    <header class="header">
      <div class="wrap">
        
        <p class="logo"><a href="https://konosuba.xyz/">Tiiktak&#39;s</a></p>
        
        
        <button class="menu-toggle" type="button"></button>
        
      </div>
    </header>
    
    <nav class="nav">
      <ul class="menu">
        
        <li>
          <a href="/about/">About</a>
        </li>
        
      </ul>
    </nav>
    
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">树莓派配置摄像头</h1>
    <div class="post-meta">2019.7.1</div>
  </header>
  <div class="post-content">

<p><em>注意：树莓派插电时千万不要插拔摄像头！据说十有八九摄像头会GG，我差点就中招了</em></p>

<h1 id="安装驱动">安装驱动</h1>

<p>首先使用ls指令查看是否加载到了对应的video device设备：</p>

<pre><code class="language-sh">ls -al /etc
</code></pre>

<p>没有看到设备开始安装驱动</p>

<h2 id="添加驱动设备到文件夹">添加驱动设备到文件夹</h2>

<pre><code class="language-sh">sudo vim /etc/modules
</code></pre>

<p>在文件末尾添加</p>

<pre><code>bcm2835-v412
</code></pre>

<h2 id="修改raspberry的启动配置">修改raspberry的启动配置</h2>

<p>进入管理中心开启pi camera</p>

<pre><code class="language-sh">sudo raspi-config
</code></pre>

<p><img src="https://ab4kqa.bl.files.1drv.com/y4mqtjMUccBRtnjSomSp3y8kTEVBwuaahFnrHIa2US5OTpZf2oafx8_UnqULj_7XvfuqeyAee7NrCBg4QhoF2dP7WRb28OgmRKGQLXBdlrFou4UpKfCHLfNCGuZVITAzzinx-wRL1Ggk_a0ghqvmoBYnSuWA2HhZe8xQNYDbg0Kqbq9sEr_rJE2fWu8Qlm5qo46YDdTyN_SCq9ENvXFUOe5lg?width=666&amp;height=367&amp;cropmode=none" alt="config" /></p>

<p>选择interfacing option</p>

<p><img src="https://bdpmsg.bl.files.1drv.com/y4mabl-I0c2Aw2giOBpuwHKIiizzuwYTD5Gb7OqAPp34LbhBXYxKz2t_6VPOGjMv1lNpqL2yZDHPggGf1cSg4-K3vhCod2ynlGS0qNYhS7H7R7r8rlpT7hLnxPDwepAXBdRAMk3Mn4XomNf3qztYe_U6E05NzQdYnlZTp6bZlSiVb3xFpWPSYusz82sdGIRE1n2U2tjpRkFPnWHIs2VRcISJw?width=662&amp;height=365&amp;cropmode=none" alt="interfacing" /></p>

<p>开启Camera后重启</p>

<h2 id="检查-dev">检查/dev</h2>

<pre><code class="language-sh">ls -al /dev/ | grep video
</code></pre>

<p>有video设备则成功</p>

<p><img src="https://n6dz7q.bl.files.1drv.com/y4mcR05MuQ5v2dAxkYVk_Zty7xaLZ1c8SgqsMCFRYJabIPoInGqksQxEfbKomsudboynWo5UB5c5DMzDFajftYIziVk_CSUwWXZ9iL27P96EUs20U0fNk2JrGaP4v6Gc2OXFb_z6eGXRVVsy90UayIP3ytY9xTyh5a5P4X4TIz4QaKcgvCH_rQtbaAR4i-RFzGdhi998B0wd5X85mPgtf4p8g?width=589&amp;height=178&amp;cropmode=none" alt="check" /></p>

<h1 id="使用树莓派摄像头">使用树莓派摄像头</h1>

<p>使用<strong>raspistill</strong>指令</p>

<h2 id="测试">测试</h2>

<pre><code class="language-sh">raspistill -o image.jpg
</code></pre>

<blockquote>
<p>在使用hdml线连接lcd屏和树莓派时运行，显示屏会显示几秒钟摄像头的实时画面，但使用VNC连接时并不会有实时画面</p>
</blockquote>

<h2 id="raspistill相关">raspistill相关</h2>

<ul>
<li>-v：查看调试信息</li>
<li>-w：图像宽度</li>
<li>-h：图像高度</li>
<li>-rot：图像旋转角度，仅支持0，90，180，270度</li>
<li>-o：图像输出地址，若文件名为&rsquo;-&lsquo;，将输出发送至标准输出设备</li>
<li>-t：获取图像前等待时间，默认为5000，即5秒</li>
<li>-tl：多久执行一次图像抓取</li>
</ul>

<h2 id="生成-h246文件">生成.h246文件</h2>

<pre><code class="language-sh">raspistill -o mykeychain.h264 -t 10000 -w 1280 -h 720
</code></pre>

<p><img src="https://qeughq.bl.files.1drv.com/y4melRxug3BWp9_qhTUPV4BBcBw2Wck-aFlizPmCuLAFmFzJ5xqvEGV8WAgRarnkO7BlcNGQWl1iwgAVdNAN2Q8x3cbD4Oor3v9lQegfIvNR0M_0WfKy6ht7i9iTVS6ZKfB9zG5U1yYYDfC_56XzNG6LvyGpxuo6A1xjXL69PBNmhfuwrfvr_b-58hA1rmYy3HBQTx4OSCZJpWAdFRMckaS2w?width=729&amp;height=93&amp;cropmode=none" alt="h264" /></p>

<h2 id="错误">错误</h2>

<p>在第一次成功调用后，之后再次调用时多次报错：</p>

<pre><code class="language-sh">mmal: No data received from sensor. Check all connections, including the Sunny one on the camera board
</code></pre>

<p>网上说导致该问题的原因有：
* 摄像头sunny部分是否连接牢靠
* 摄像头是否插紧
* 最可能：在树莓派带电的时候插拔摄像头，导致管脚烧坏了。这个时候就需要找到是哪个管脚烧坏了，然后补焊一下，加点阻焊剂；</p>

<p>最开始不知道不能热插拔，带点插拔了两三次，不过幸好后面关机重新插了之后就正常了，差点就是血的教训了</p>

<h1 id="vlc实现http视频流传输">VLC实现http视频流传输</h1>

<p>在树莓派输入如下命令</p>

<pre><code class="language-sh">sudo raspivid -o - -t 0 -w 640 -h 360 -fps 25|cvlc -vvv stream:///dev/stdin --sout '#standard{access=http,mux=ts,dst=:8090}' :demux=h264
</code></pre>

<p>意思：使用PI官方的raspivid捕获视频工具把视频流输出到vlc，通过vlc转码成h264网络视频流通过http协议以ts的形式封装，然后输出到8090端口，用这个当监控只要网络稳定绝对不卡。</p>

<p>之后使用VLC客户端，网络串流:<code>http://树莓派ip:8090</code>即可，不过延迟较高，可能是因为我用的手机热点的原因，之后再试。</p>

<h1 id="opencv调用树莓派摄像头">opencv调用树莓派摄像头</h1>

<p>配置好opencv后，就能使用opencv自带的videocapture调用摄像头</p>

<h2 id="c-调用">C++调用</h2>

<p>参考<a href="https://blog.csdn.net/jinmie0193/article/details/79969649">这里</a>，成功调用</p>

<p>代码：</p>

<pre><code class="language-cpp">
void OpenCamera()
{
	//打开摄像头
	VideoCapture capture;
	capture.open(0);
	//灰度图像
	Mat edge;
	//循环显示每一帧
	while (1)
	{
		//frame存储每一帧图像
		Mat frame;
		//读取当前帧
		capture &gt;&gt; frame;
		//显示当前视频
		imshow(&quot;正在录制&quot;, frame);
		//得到灰度图像
		cvtColor(frame, edge, CV_BGR2GRAY);
		//3*3降噪 （2*3+1)
		blur(edge, edge,Size(7,7));
		//边缘显示
		Canny(edge,edge,0,30,3);
		imshow(&quot;高斯模糊视频&quot;,edge);
	}
}
</code></pre>

<p>使用VNC连接时延迟较高，在使用HDMI显示屏时效果较好，延迟较低</p>

<p>VNC连接：</p>

<p><img src="https://nqd97q.bl.files.1drv.com/y4m2DHh3L6QzoZ5FiLnzP2WBIE1e-QrYPK6SX_bCxZ2bcb0kyvJ9KD51LWfoDfnouWtcy47q1VY7Uxjqeq_vYTd22na0erHBYdAse1qtcg3AqPsq1Tr6u6Mh_LASanfUmDubNkHVulgz7xIAb5Du7OJUT6poGMxO-KGGwDnOuIWE8DkF05kGvd_4emMwxzbHtpbXiQtz7wItLXcmvwaT8GOrQ?width=1026&amp;height=800&amp;cropmode=none" alt="video-cpp-vnc" /></p>

<p>HDMI连接：</p>

<p>![video-cpp-hdmi]()</p>

<h2 id="python调用">Python调用</h2>

<p>参考<a href="https://projects.raspberrypi.org/en/projects/getting-started-with-picamera/5">官网指南</a></p>

<p>*本文参考：<a href="https://blog.csdn.net/qq_38880380/article/details/78728509">使用树莓派CSI摄像头时报错</a>;<a href="https://www.cnblogs.com/uestc-mm/p/7587783.html">树莓派3 B+ 的摄像头简单使用</a></p>
</div>
  <footer class="post-footer">
    
  </footer>
  
  
  
  <div id="disqus_thread"></div>
  <script>
    var disqus_shortname = 'tiiktak';
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  
  
</article>

</main>
<footer class="footer">
  <span>&copy; 2020 <a href="https://konosuba.xyz/">Tiiktak&#39;s</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="https://konosuba.xyz/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://konosuba.xyz/js/highlight.min.js" data-no-instant></script>
<script data-no-instant>
  let body;
  function menuToggleListener() {
    body.classList.toggle('blur');
  }
  function setMenuToggleListener() {
    const menuToggle = document.querySelector('.menu-toggle');
    if (!menuToggle) return;
    body = document.querySelector('body');
    menuToggle.addEventListener('click', menuToggleListener);
  }

  hljs.initHighlightingOnLoad();
  setMenuToggleListener();

  InstantClick.on('change', function () {
    document.querySelectorAll('pre code').forEach((block) => {
      hljs.highlightBlock(block);
    });
    setMenuToggleListener();
  });
</script>
</body>
</html>

